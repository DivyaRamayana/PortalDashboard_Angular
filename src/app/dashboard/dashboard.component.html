<ngx-ui-loader></ngx-ui-loader>
<div class="container-fluid">
  
        <div class="header">
            <h2>Rexnord Portal Automation</h2>
        </div>
    </div>
<div class="container-fluid" >
    <div class="card">
        <div class="card-header">
            <div class="row">
                <div class="col-md-6  col-sm-6"> <b>Filters</b></div>
               
            </div>
        </div>

        <div class="card-body">
                <div class="row">
                    <div class="col-md-4 mt-2">
                        <label>Portal:</label>&nbsp;
                        <select class="form-control" [(ngModel)]="portal" name="portal" id="" [value]="pipeFilter"
                            (input)="pipeFilter = $event.target.value">
                            <!-- <option value="-">-</option> -->
                            <option  *ngFor="let r of xmlItems;" (value)="r.name">{{r.name}}</option>
                            <!-- <option value="Krones">Krones</option> -->
                        </select>
                    </div>
                    <div class="col-md-4 mt-2">
                        <label>Date:</label>
                        <div class="form-group">
                            <div class="input-group">
                                <input class="form-control" placeholder="DD-MM-YYYY" ngbDatepicker #d="ngbDatepicker"
                                    [startDate]="fromDate!" [(ngModel)]="fromDate" name="fromDate">
                                <div class="input-group-append"><span class="input-group-text">
                                    <div class="calendar" (click)="d.toggle()"><img src="./assets/img/calendar.png"
                                            style="width: 1.2rem; height: 1rem; cursor: pointer;" /></div></span>
                                </div>
                            </div>
                        </div>
                    </div>

                

                    <!-- <div class="col-md-4 mt-2">
                        <label>TO Date:</label>
                        <div class="form-group">
                            <div class="input-group">
                                <input class="form-control" placeholder="DD-MM-YYYY" ngbDatepicker #d="ngbDatepicker"
                                    [startDate]="toDate!" [(ngModel)]="toDate" name="toDate">
                                <div class="input-group-append">
                                    <div class="calendar" (click)="d.toggle()"><img src="./assets/img/calendar.png"
                                            style="width: 1.2rem; height: 1rem; cursor: pointer;" /></div>
                                </div>
                            </div>
                        </div>
                    </div> -->
                    <div class="col-md-4 mt-2">
                        <label>Time </label>&nbsp;
                        <select class="form-control" [(ngModel)]="time" name="time">
                            <option>-</option>
                            <option value="01">01:00:00 AM</option>
                            <option value="02">02:00:00 AM</option>
                            <option value="03">03:00:00 AM</option>
                            <option value="04">04:00:00 AM</option>
                            <option value="05">05:00:00 AM</option>
                            <option value="06">06:00:00 AM</option>
                            <option value="07">07:00:00 AM</option>
                            <option value="08">08:00:00 AM</option>
                            <option value="09">09:00:00 AM</option>
                            <option value="10">10:00:00 AM</option>
                            <option value="11">11:00:00 AM</option>
                            <option value="12">12:00:00 PM</option>
                            <option value="13">13:00:00 PM</option>
                            <option value="14">14:00:00 PM</option>
                            <option value="15">15:00:00 PM</option>
                            <option value="16">16:00:00 PM</option>
                            <option value="17">17:00:00 PM</option>
                            <option value="18">18:00:00 PM</option>
                            <option value="19">19:00:00 PM</option>
                            <option value="20">20:00:00 PM</option>
                            <option value="21">21:00:00 PM</option>
                            <option value="22">22:00:00 PM</option>
                            <option value="23">23:00:00 PM</option>
                            <option value="24">24:00:00 PM</option>
                        </select>
                    </div> 
                    <div class="col-md-12 text-center mt-3">
                        <button class="btn btn-primary" (click)="getCsvs()">SUBMIT</button>
                    </div>
                </div>
            </div>
   
    </div>
    <div class="card mt-4">
        <div class="card-header">
            <div class="row">
                <div class="col-md-6  col-sm-6"><b> Controls</b></div>
                
            </div>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4"><b>Portal : KHS </b> </div>
                <!-- <div class="col-md-4"><b>Order Downloaded : </b></div> -->
                <div class="col-offset-md-4 col-md-4"><b> Status :</b> Success </div>
            </div>
            <div class="row mt-4">
                <div class="col-md-4 col-sm-4">
                    <button type="button" class="btn btn-info btn-block" (click)="manualRun()"> Manual Run</button>
                    <!-- <input type="button" value=" Manual Run" (click)="window.open(callBatFile)" />  -->
                </div>
                <div class="col-md-4 col-sm-4">
                    <button type="button" class="btn btn-success btn-block " (click)="open(mymodal)" >Daily Log</button>
                </div>
                <div class="col-md-4 col-sm-4">
                    <button type="button" class="btn btn-primary btn-block" disabled>Config</button>
                </div>
    
            </div>
        </div>
    </div>
    <div class="card mt-4">
        <div class="card-header">
            <div class="row">
                <div class="col-md-3  col-sm-3"> <b>Result</b></div>

            </div>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered mb-2">
                    <thead>
                        <tr>
                            <!-- <th>Sr No.</th> -->
                            <th>#</th>
                            <th>Portal</th>
                            <th>Date</th>
                            <th>Time</th>
                            <th>Download Status</th>
                            <th>Customer Po. No.</th>
                            <th>Directory path</th>
                            <th>SAP Order No.</th>
                            <th>Confirm Date</th>
                            <th>Comments</th>
                            <th>Processing Status</th>
                            <th>Update CSV</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Portal": "KHS",
                        "Date": "10062020",
                        "Time": "1212",
                        "Status": "Success",
                        "Customer PO Number": "004517955",
                        "Directory path": "E:\\Test_Portal_Automation\\KHS\\Run\\10062020\\Data\\KHS_10062020_1212_ZMEOORD49_0045179553.pdf",
                        "SAP Order number": "",
                        "Order confirm Date": "",
                        "Processing Status": "UnProcessed",
                        "Comments": "NA",
                        "mm": "['']",
                        "test": -->
    
                        <tr *ngFor="let r of csvData; let i = index">
                            <td>{{i+1}}</td>
                            <td>{{r.Portal}}</td>
                            <td>{{r.Date }}</td>
                            <td>{{r.Time }}</td>
                            <td>{{r["Download Status"]}}</td>
                            <td>{{r["Customer PO Number"]}}</td>
                            <td>
                                <a [href]="getInvoiceUrl(r['Directory path'])" target="_blank"> Download PDF</a>
                                <!-- <a  (click)="getInvoiceUrl(r['Directory path'])" target="_blank"> Download PDF</a> -->
                                <!-- <button type="button" class="btn btn-primary btn-block " (click)="getInvoiceUrl(r['Directory path'])" >Download PDF</button> -->
                            </td>
                            <td>
                                <div *ngIf="r.edit">
                                    <input type="text" [(ngModel)]="r['SAP Order number']">
                                </div>                                
                                <div  *ngIf="!r.edit">
                                    {{r['SAP Order number']}}
                                </div>
    
                               
                                <!-- <button class="btn btn-sm btn-primary m-1">save<i class="fa fa-check"></i></button> -->
                            </td>
                            <td style="width: 13%;">
                                <!-- <input type="text" [(ngModel)]="r.OrderConfirmDate"> -->
                                <!-- <div class="form-group" > -->
                                    <div class="input-group"  *ngIf="r.edit">
                                        <input class="form-control" placeholder="DD-MM-YYYY" ngbDatepicker #d="ngbDatepicker"
                                              name="fromDate"  [(ngModel)]="r['confirm_Date']" >
                                        <div class="input-group-append"><span class="input-group-text">
                                            <div class="calendar" (click)="d.toggle()"><img src="./assets/img/calendar.png"
                                                    style="width: 1.2rem; height: 1rem; cursor: pointer;" /></div></span>
                                        </div>
                                    </div>
                                <!-- </div> -->
                                <div  *ngIf="!r.edit">
                                    {{r['Order confirm Date']}}
                                </div>
                            </td>
                            <td>
                                <div *ngIf="r.edit">
                                    <textarea type="text" [(ngModel)]="r['Comments']"></textarea>
                                </div>                                
                                <div  *ngIf="!r.edit">
                                    {{r['Comments']}}
                                </div>
                            <td> 
                                
                                <div *ngIf="r.edit">
                                    <input type="text" [(ngModel)]="r['Processing Status']">
                                </div>                                
                                <div  *ngIf="!r.edit">
                                    {{r['Processing Status']}}
                                </div>
                                
                                
                                
                            <td> 
                                <button *ngIf="!r.edit" class="btn btn-sm btn-info m-1" (click)="r['edit']= true">edit<i class="fa fa-check"></i></button> 
                                <button *ngIf="r.edit" class="btn btn-sm btn-success m-1" (click)="r['edit']=false; saveData()">save<i class="fa fa-check"></i></button> 
                                <button class="btn btn-sm btn-danger m-1" (click)="onClear()">clear<i class="fa fa-check"></i></button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<ng-template #mymodal let-modal>
    <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title"> Daily logs</h4>
        <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
            <span aria-hidden="true">×</span>
        </button>
    </div>
    <div class="modal-body" style="height:400px; overflow-y: scroll;">
        {{modallogdata}}
    </div>
</ng-template>